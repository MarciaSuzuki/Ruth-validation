<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prose Meaning Maps ‚Äî OBT Lab</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400;1,600&family=Source+Serif+4:ital,opsz,wght@0,8..60,300;0,8..60,400;0,8..60,600;1,8..60,300;1,8..60,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --teal-dark: #0d3b38;
  --teal: #165c57;
  --teal-mid: #1e7a72;
  --teal-light: #2a9d8f;
  --gold: #c9a84c;
  --gold-light: #e3c97e;
  --cream: #faf6ef;
  --cream-dark: #f0e9dc;
  --ink: #1a1a1a;
  --ink-mid: #3a3a3a;
  --ink-light: #6b6b6b;
  --rust: #a0522d;
  --error: #c0392b;
  --white: #ffffff;
  --shadow: 0 4px 24px rgba(13,59,56,0.12);
  --shadow-sm: 0 2px 8px rgba(13,59,56,0.08);
  --radius: 8px;
  --radius-lg: 16px;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: 'Source Serif 4', Georgia, serif;
  background: var(--cream);
  color: var(--ink);
  min-height: 100vh;
  font-size: 16px;
  line-height: 1.65;
}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
header {
  background: var(--teal-dark);
  color: var(--white);
  padding: 0;
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: 0 2px 16px rgba(0,0,0,0.25);
}

.header-top {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 32px 10px;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}

.header-brand h1 {
  font-family: 'Playfair Display', serif;
  font-size: 1.55rem;
  font-weight: 700;
  letter-spacing: 0.01em;
  line-height: 1.2;
}

.header-brand .subtitle {
  font-size: 0.72rem;
  color: var(--gold-light);
  letter-spacing: 0.12em;
  text-transform: uppercase;
  font-family: 'Source Serif 4', serif;
  font-weight: 300;
}

.header-org {
  text-align: right;
  font-size: 0.72rem;
  color: rgba(255,255,255,0.6);
  line-height: 1.5;
  font-family: 'Source Serif 4', serif;
}

.header-org a {
  color: var(--gold-light);
  text-decoration: none;
}

nav {
  display: flex;
  padding: 0 24px;
  gap: 0;
  overflow-x: auto;
}

nav button {
  background: none;
  border: none;
  color: rgba(255,255,255,0.65);
  padding: 10px 20px;
  font-family: 'Source Serif 4', serif;
  font-size: 0.82rem;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  transition: all 0.2s;
  white-space: nowrap;
}

nav button:hover { color: var(--white); }

nav button.active {
  color: var(--gold-light);
  border-bottom: 2px solid var(--gold);
}

/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
main {
  max-width: 960px;
  margin: 0 auto;
  padding: 40px 24px 120px;
}

.tab-panel { display: none; }
.tab-panel.active { display: block; }

/* ‚îÄ‚îÄ TYPOGRAPHY ‚îÄ‚îÄ */
h2 {
  font-family: 'Playfair Display', serif;
  font-size: 1.75rem;
  color: var(--teal-dark);
  margin-bottom: 6px;
}

h3 {
  font-family: 'Playfair Display', serif;
  font-size: 1.2rem;
  color: var(--teal);
  margin-bottom: 4px;
}

h4 {
  font-family: 'Source Serif 4', serif;
  font-weight: 600;
  font-size: 0.9rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--teal-mid);
  margin-bottom: 8px;
}

p { margin-bottom: 1rem; }

.lead {
  font-size: 1.05rem;
  color: var(--ink-mid);
  font-style: italic;
  margin-bottom: 1.5rem;
}

/* ‚îÄ‚îÄ CARDS & BOXES ‚îÄ‚îÄ */
.card {
  background: var(--white);
  border-radius: var(--radius-lg);
  padding: 28px 32px;
  box-shadow: var(--shadow-sm);
  margin-bottom: 24px;
  border: 1px solid rgba(0,0,0,0.06);
}

.rule-box {
  background: var(--teal-dark);
  color: var(--white);
  border-radius: var(--radius-lg);
  padding: 24px 28px;
  margin-bottom: 28px;
}

.rule-box h3 {
  font-family: 'Playfair Display', serif;
  color: var(--gold-light);
  margin-bottom: 12px;
  font-size: 1.1rem;
}

.rule-box p { color: rgba(255,255,255,0.88); margin-bottom: 0.75rem; font-size: 0.95rem; }
.rule-box p:last-child { margin-bottom: 0; }

.notice {
  background: var(--cream-dark);
  border-left: 4px solid var(--teal-light);
  padding: 14px 18px;
  border-radius: 0 var(--radius) var(--radius) 0;
  margin-bottom: 20px;
  font-size: 0.9rem;
  color: var(--ink-mid);
  font-style: italic;
}

.warning {
  background: #fff8e1;
  border-left: 4px solid var(--gold);
  padding: 14px 18px;
  border-radius: 0 var(--radius) var(--radius) 0;
  margin-bottom: 20px;
  font-size: 0.9rem;
  color: var(--ink-mid);
}

/* ‚îÄ‚îÄ SECTION HEADERS ‚îÄ‚îÄ */
.section-header {
  background: var(--teal);
  color: var(--white);
  border-radius: var(--radius) var(--radius) 0 0;
  padding: 14px 20px;
  margin-bottom: 0;
  display: flex;
  align-items: center;
  gap: 12px;
}

.section-header .level-badge {
  background: var(--gold);
  color: var(--teal-dark);
  border-radius: 20px;
  padding: 2px 12px;
  font-size: 0.72rem;
  font-weight: 700;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  font-family: 'Source Serif 4', serif;
}

.section-header h3 {
  color: var(--white);
  font-family: 'Playfair Display', serif;
  font-size: 1.05rem;
  margin: 0;
}

.section-body {
  background: var(--white);
  border: 1px solid rgba(0,0,0,0.08);
  border-top: none;
  border-radius: 0 0 var(--radius-lg) var(--radius-lg);
  padding: 24px;
  margin-bottom: 28px;
}

/* ‚îÄ‚îÄ TABLES ‚îÄ‚îÄ */
.data-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.88rem;
  margin-bottom: 16px;
}

.data-table th {
  background: var(--teal-mid);
  color: var(--white);
  padding: 10px 12px;
  text-align: left;
  font-family: 'Source Serif 4', serif;
  font-weight: 600;
  font-size: 0.78rem;
  letter-spacing: 0.05em;
}

.data-table td {
  padding: 9px 12px;
  border-bottom: 1px solid rgba(0,0,0,0.06);
  vertical-align: top;
  line-height: 1.5;
}

.data-table tr:nth-child(even) td { background: var(--cream); }

/* ‚îÄ‚îÄ PROPOSITION BLOCKS (example) ‚îÄ‚îÄ */
.prop-block {
  background: var(--cream);
  border-radius: var(--radius);
  padding: 16px 20px;
  margin-bottom: 12px;
  border: 1px solid rgba(0,0,0,0.07);
}

.prop-block .prop-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 10px;
}

.prop-num {
  background: var(--teal-light);
  color: var(--white);
  border-radius: 50%;
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.78rem;
  font-weight: 700;
  flex-shrink: 0;
}

.prop-verse {
  font-family: 'Source Serif 4', serif;
  font-weight: 600;
  font-size: 0.85rem;
  color: var(--teal-dark);
}

.prop-type {
  font-size: 0.8rem;
  color: var(--ink-light);
  font-style: italic;
}

.slot-list {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.slot-row {
  display: flex;
  gap: 8px;
  font-size: 0.88rem;
}

.slot-key {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.75rem;
  color: var(--teal-mid);
  font-weight: 500;
  min-width: 120px;
  padding-top: 2px;
}

.slot-val { color: var(--ink); }

/* ‚îÄ‚îÄ FORM ELEMENTS ‚îÄ‚îÄ */
.form-group {
  margin-bottom: 18px;
}

label.field-label {
  display: block;
  font-weight: 600;
  font-size: 0.82rem;
  text-transform: uppercase;
  letter-spacing: 0.07em;
  color: var(--teal-dark);
  margin-bottom: 5px;
}

.field-hint {
  font-size: 0.8rem;
  color: var(--ink-light);
  font-style: italic;
  margin-bottom: 6px;
}

input[type="text"], textarea, select {
  width: 100%;
  border: 1.5px solid #d0cfc8;
  border-radius: var(--radius);
  padding: 9px 12px;
  font-family: 'Source Serif 4', serif;
  font-size: 0.92rem;
  color: var(--ink);
  background: var(--white);
  transition: border-color 0.2s, box-shadow 0.2s;
  outline: none;
}

input[type="text"]:focus, textarea:focus, select:focus {
  border-color: var(--teal-light);
  box-shadow: 0 0 0 3px rgba(42,157,143,0.12);
}

textarea { resize: vertical; min-height: 90px; }

.meta-grid {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 16px;
  margin-bottom: 24px;
}

@media(max-width: 640px) { .meta-grid { grid-template-columns: 1fr 1fr; } }

/* ‚îÄ‚îÄ SCENE BLOCKS (form) ‚îÄ‚îÄ */
.scene-block {
  border: 1.5px solid rgba(0,0,0,0.09);
  border-radius: var(--radius-lg);
  margin-bottom: 28px;
  overflow: hidden;
}

.scene-block-header {
  background: var(--teal);
  color: var(--white);
  padding: 12px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.scene-block-header h4 {
  color: var(--white);
  text-transform: none;
  letter-spacing: 0;
  font-size: 0.95rem;
  margin: 0;
  font-family: 'Playfair Display', serif;
  font-weight: 600;
}

.scene-block-body { padding: 20px; background: var(--white); }

.sub-section {
  background: var(--cream);
  border-radius: var(--radius);
  padding: 16px;
  margin-bottom: 16px;
}

.sub-section h4 {
  color: var(--teal-dark);
  font-size: 0.8rem;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  margin-bottom: 10px;
}

/* ‚îÄ‚îÄ DYNAMIC TABLE EDITOR ‚îÄ‚îÄ */
.dyn-table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
.dyn-table th {
  background: var(--teal-mid);
  color: var(--white);
  padding: 7px 10px;
  font-size: 0.75rem;
  font-family: 'Source Serif 4', serif;
  letter-spacing: 0.05em;
  text-align: left;
}
.dyn-table td { padding: 4px 4px; vertical-align: top; }
.dyn-table input[type="text"] {
  padding: 6px 8px;
  font-size: 0.82rem;
  min-width: 0;
}
.dyn-table .del-btn {
  background: none;
  border: none;
  color: var(--error);
  cursor: pointer;
  font-size: 1.1rem;
  padding: 4px 6px;
  border-radius: 4px;
  transition: background 0.15s;
}
.dyn-table .del-btn:hover { background: #fde8e8; }

/* ‚îÄ‚îÄ PROP FORM BLOCKS ‚îÄ‚îÄ */
.prop-form-block {
  border: 1.5px solid rgba(0,0,0,0.09);
  border-radius: var(--radius-lg);
  margin-bottom: 20px;
  overflow: hidden;
}

.prop-form-header {
  background: var(--cream-dark);
  padding: 10px 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid rgba(0,0,0,0.08);
}

.prop-form-header .prop-label {
  font-family: 'Source Serif 4', serif;
  font-weight: 600;
  font-size: 0.85rem;
  color: var(--teal-dark);
  display: flex;
  align-items: center;
  gap: 8px;
}

.prop-form-body { padding: 16px 20px; }

.slot-editor { margin-top: 10px; }
.slot-editor .slot-row-edit {
  display: flex;
  gap: 8px;
  margin-bottom: 6px;
  align-items: center;
}
.slot-editor .slot-row-edit input { flex: 1; }
.slot-editor .slot-key-input { max-width: 160px; font-family: 'JetBrains Mono', monospace; font-size: 0.78rem; }

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 9px 18px;
  border-radius: var(--radius);
  border: none;
  cursor: pointer;
  font-family: 'Source Serif 4', serif;
  font-size: 0.88rem;
  font-weight: 600;
  letter-spacing: 0.03em;
  transition: all 0.2s;
}

.btn-primary {
  background: var(--teal);
  color: var(--white);
}
.btn-primary:hover { background: var(--teal-mid); transform: translateY(-1px); box-shadow: var(--shadow-sm); }

.btn-secondary {
  background: var(--cream-dark);
  color: var(--teal-dark);
  border: 1.5px solid var(--cream-dark);
}
.btn-secondary:hover { background: #e3d9ca; }

.btn-gold {
  background: var(--gold);
  color: var(--teal-dark);
}
.btn-gold:hover { background: var(--gold-light); }

.btn-ghost {
  background: transparent;
  color: var(--teal);
  border: 1.5px solid currentColor;
}
.btn-ghost:hover { background: rgba(42,157,143,0.08); }

.btn-danger {
  background: transparent;
  color: var(--error);
  border: 1.5px solid currentColor;
  font-size: 0.8rem;
  padding: 5px 12px;
}
.btn-danger:hover { background: #fde8e8; }

.btn-sm { padding: 6px 12px; font-size: 0.8rem; }

.btn-row {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-top: 12px;
}

/* ‚îÄ‚îÄ CHECKLIST ‚îÄ‚îÄ */
.checklist { list-style: none; padding: 0; }
.checklist li {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 10px 0;
  border-bottom: 1px solid rgba(0,0,0,0.06);
  cursor: pointer;
  transition: background 0.15s;
  border-radius: var(--radius);
  padding-left: 8px;
  padding-right: 8px;
}
.checklist li:hover { background: var(--cream); }
.checklist li:last-child { border-bottom: none; }

.checklist li input[type="checkbox"] {
  width: 20px;
  height: 20px;
  min-width: 20px;
  accent-color: var(--teal-light);
  cursor: pointer;
  margin-top: 2px;
}

.checklist li span { font-size: 0.92rem; line-height: 1.5; }
.checklist li.checked span { text-decoration: line-through; color: var(--ink-light); }

/* ‚îÄ‚îÄ JSON VIEW ‚îÄ‚îÄ */
.json-output {
  background: #0d1f1e;
  color: #a8d8b9;
  border-radius: var(--radius-lg);
  padding: 24px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.78rem;
  line-height: 1.7;
  overflow-x: auto;
  white-space: pre;
  max-height: 600px;
  overflow-y: auto;
  position: relative;
}

.json-key { color: #7ec8c8; }
.json-string { color: #c8d8a8; }
.json-number { color: #e8c07d; }
.json-null { color: #888; }

/* ‚îÄ‚îÄ FLOATING ASSISTANT ‚îÄ‚îÄ */
#assistant-btn {
  position: fixed;
  bottom: 32px;
  right: 32px;
  width: 58px;
  height: 58px;
  border-radius: 50%;
  background: var(--teal-dark);
  color: var(--white);
  border: 3px solid var(--gold);
  cursor: pointer;
  box-shadow: 0 4px 20px rgba(13,59,56,0.35);
  z-index: 200;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  transition: transform 0.2s, box-shadow 0.2s;
}
#assistant-btn:hover { transform: scale(1.08); box-shadow: 0 6px 28px rgba(13,59,56,0.45); }

#assistant-panel {
  position: fixed;
  bottom: 104px;
  right: 32px;
  width: 360px;
  max-width: calc(100vw - 48px);
  background: var(--white);
  border-radius: var(--radius-lg);
  box-shadow: 0 8px 40px rgba(0,0,0,0.18);
  z-index: 200;
  display: none;
  flex-direction: column;
  overflow: hidden;
  border: 1px solid rgba(0,0,0,0.08);
}

#assistant-panel.open { display: flex; }

.asst-header {
  background: var(--teal-dark);
  color: var(--white);
  padding: 14px 18px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.asst-header h4 {
  color: var(--gold-light);
  font-family: 'Playfair Display', serif;
  font-size: 1rem;
  font-weight: 600;
  text-transform: none;
  letter-spacing: 0;
  margin: 0;
}

.asst-header button {
  background: none;
  border: none;
  color: rgba(255,255,255,0.7);
  cursor: pointer;
  font-size: 1.1rem;
  padding: 2px 6px;
  border-radius: 4px;
}
.asst-header button:hover { color: white; background: rgba(255,255,255,0.1); }

.asst-messages {
  flex: 1;
  overflow-y: auto;
  padding: 16px;
  max-height: 320px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.asst-msg {
  padding: 10px 14px;
  border-radius: var(--radius);
  font-size: 0.88rem;
  line-height: 1.55;
  max-width: 90%;
}

.asst-msg.system {
  background: var(--cream-dark);
  color: var(--ink-mid);
  font-style: italic;
  align-self: center;
  text-align: center;
  font-size: 0.8rem;
  max-width: 100%;
}

.asst-msg.user {
  background: var(--teal);
  color: var(--white);
  align-self: flex-end;
  border-bottom-right-radius: 3px;
}

.asst-msg.assistant {
  background: var(--cream);
  color: var(--ink);
  align-self: flex-start;
  border-bottom-left-radius: 3px;
  border: 1px solid rgba(0,0,0,0.06);
}

.asst-msg.thinking {
  background: var(--cream);
  color: var(--ink-light);
  font-style: italic;
  align-self: flex-start;
}

.asst-input-row {
  display: flex;
  gap: 8px;
  padding: 12px 16px;
  border-top: 1px solid rgba(0,0,0,0.08);
  background: var(--white);
}

.asst-input-row input {
  flex: 1;
  padding: 8px 12px;
  font-size: 0.88rem;
  border-radius: 20px;
  border: 1.5px solid #d0cfc8;
}

.asst-input-row button {
  background: var(--teal);
  color: var(--white);
  border: none;
  border-radius: 50%;
  width: 36px;
  height: 36px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1rem;
  transition: background 0.2s;
  flex-shrink: 0;
}
.asst-input-row button:hover { background: var(--teal-mid); }
.asst-input-row button:disabled { background: #ccc; cursor: not-allowed; }

/* ‚îÄ‚îÄ MISC ‚îÄ‚îÄ */
.divider {
  border: none;
  border-top: 1px solid rgba(0,0,0,0.1);
  margin: 28px 0;
}

.tag {
  display: inline-block;
  background: var(--teal-light);
  color: var(--white);
  border-radius: 20px;
  padding: 2px 10px;
  font-size: 0.72rem;
  font-family: 'Source Serif 4', serif;
  font-weight: 600;
  letter-spacing: 0.06em;
}

.tag-gold {
  background: var(--gold);
  color: var(--teal-dark);
}

.fade-in {
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to   { opacity: 1; transform: translateY(0); }
}

.page-title {
  display: flex;
  align-items: flex-start;
  gap: 16px;
  margin-bottom: 28px;
  padding-bottom: 20px;
  border-bottom: 2px solid var(--cream-dark);
}

.page-title-icon {
  font-size: 2.2rem;
  line-height: 1;
  margin-top: 4px;
}

.page-title h2 { margin-bottom: 4px; }
.page-title p { color: var(--ink-light); font-size: 0.95rem; margin: 0; }

.save-status {
  font-size: 0.8rem;
  color: var(--teal-mid);
  font-style: italic;
  margin-left: 8px;
}

.json-toolbar {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 16px;
  align-items: center;
}

.json-section-label {
  font-family: 'Source Serif 4', serif;
  font-size: 0.8rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--ink-light);
  margin-bottom: 6px;
}

/* ‚îÄ‚îÄ EXAMPLE STYLES ‚îÄ‚îÄ */
.example-scene {
  border-left: 4px solid var(--teal-light);
  padding-left: 16px;
  margin-bottom: 24px;
}

.example-scene h3 {
  font-size: 1.05rem;
  margin-bottom: 12px;
  color: var(--teal-dark);
}

/* collapsible */
details {
  border: 1px solid rgba(0,0,0,0.08);
  border-radius: var(--radius);
  margin-bottom: 12px;
  overflow: hidden;
}

details summary {
  background: var(--cream);
  padding: 12px 16px;
  cursor: pointer;
  font-weight: 600;
  font-size: 0.92rem;
  color: var(--teal-dark);
  user-select: none;
  list-style: none;
  display: flex;
  align-items: center;
  gap: 8px;
}

details summary::-webkit-details-marker { display: none; }
details summary::before {
  content: '‚ñ∂';
  font-size: 0.65rem;
  transition: transform 0.2s;
  color: var(--teal-light);
}
details[open] summary::before { transform: rotate(90deg); }

details .details-body {
  padding: 16px;
  background: var(--white);
}
</style>
</head>
<body>

<header>
  <div class="header-top">
    <div class="header-brand">
      <h1>Prose Meaning Maps</h1>
      <div class="subtitle">Tripod Method ¬∑ AI-Assisted Oral Bible Translation</div>
    </div>
    <div class="header-org">
      OBT Lab ¬∑ Shema Bible Translation<br>
      YWAM Kansas City ¬∑ University of the Nations<br>
      <a href="mailto:marcia.suzuki@uofn.edu">marcia.suzuki@uofn.edu</a>
    </div>
  </div>
  <nav>
    <button class="active" onclick="showTab('instructions')">‚ë† Instructions</button>
    <button onclick="showTab('example')">‚ë° Worked Example</button>
    <button onclick="showTab('form')">‚ë¢ Create Map</button>
    <button onclick="showTab('json')">‚ë£ JSON Output</button>
  </nav>
</header>

<main>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB 1: INSTRUCTIONS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="tab-instructions" class="tab-panel active fade-in">

  <div class="page-title">
    <div class="page-title-icon">üìú</div>
    <div>
      <h2>What Is a Prose Meaning Map?</h2>
      <p>A complete guide to creating maps that guide faithful oral Bible translation</p>
    </div>
  </div>

  <div class="rule-box">
    <h3>Your Role</h3>
    <p>You are not a translator. You are a <strong>director describing a script to actors who speak a language you don't know.</strong> Your job is to make the situation so vivid at every level ‚Äî the whole book, each scene, every line ‚Äî that they can re-enact it faithfully in their own language.</p>
    <p>The biblical text is for your eyes only. It never appears in your maps.</p>
  </div>

  <div class="rule-box" style="background: #1a3a2a;">
    <h3>The Core Rule</h3>
    <p><strong>Never reproduce the sentences or clauses of the biblical text.</strong> That is what creates translationese ‚Äî a target language forced into the grammatical and syntactic mold of the source. The performer must construct each sentence from scratch in their own language.</p>
    <p>However: <strong>individual words for specific things</strong> ‚Äî a tree, a road, a king, a famine, a proper name, a named period of time ‚Äî must be named directly and carried into the map unchanged. Do not paraphrase them.</p>
    <p><em>The rule is: describe the situation without reproducing its sentences. Name every thing in it precisely.</em></p>
  </div>

  <div class="warning">
    <strong>The Paraphrase Test:</strong> If you wrote something that could be translated back into English and reproduce the original Bible verse, you have failed. Delete it and describe the situation instead.
  </div>

  <hr class="divider">

  <h3 style="margin-bottom: 16px;">The Three Levels</h3>

  <div class="card">
    <div style="display:flex; align-items:center; gap:12px; margin-bottom:12px;">
      <span class="tag">Level 1</span>
      <h3 style="margin:0;">The Movement</h3>
    </div>
    <p><em>One paragraph per chapter or major section.</em></p>
    <p>Describe the arc of the whole passage. Cover the emotional trajectory (from emptiness to hope? from risk to security?), the theological significance (how does God act? what covenant themes emerge?), what this section accomplishes in the larger story, and the pacing ‚Äî the shape of the narrative energy.</p>
    <div class="notice">This is the "soul" of the passage. The performer needs to inhabit this world before they speak a word.</div>
  </div>

  <div class="card">
    <div style="display:flex; align-items:center; gap:12px; margin-bottom:12px;">
      <span class="tag">Level 2</span>
      <h3 style="margin:0;">The Scenes</h3>
    </div>
    <p><em>Divide the passage into natural episodes (3‚Äì6 verses each). Complete one full block per scene.</em></p>
    <p>Each scene block covers:</p>
    <ul style="padding-left:20px; margin-bottom:12px; font-size:0.93rem; line-height:2;">
      <li><strong>2A ‚Äî People:</strong> Every person present, with name where the text gives it. No one omitted.</li>
      <li><strong>2B ‚Äî Places:</strong> Every location mentioned or implied, including transitional spaces. Named.</li>
      <li><strong>2C ‚Äî Objects &amp; Elements:</strong> Everything physical: artifacts, food, animals, plants, natural features, durations. Nothing is too minor. Note significant absences too.</li>
      <li><strong>2D ‚Äî What Happens:</strong> Full sequence of actions, in order.</li>
      <li><strong>2E ‚Äî Communicative Purpose:</strong> Why does this scene exist?</li>
    </ul>
    <div class="notice">Completeness is the standard. A map with gaps cannot guide a faithful performance.</div>
  </div>

  <div class="card">
    <div style="display:flex; align-items:center; gap:12px; margin-bottom:12px;">
      <span class="tag">Level 3</span>
      <h3 style="margin:0;">The Propositions</h3>
    </div>
    <p><em>One block per verse or closely connected clause cluster. Every verse receives a block.</em></p>
    <p>Each proposition block contains only <strong>labeled semantic slots</strong> ‚Äî the exact meaning components the performer must communicate. No sentences, no commentary. Just: <em>who / what happened / where / when / from where / to where / with whom / why</em> ‚Äî whatever labels fit that verse.</p>
    <div class="notice">If Levels 1 and 2 give the world the performer needs to inhabit, Level 3 tells them exactly what each sentence must say. Short, direct, complete.</div>
    <p style="font-size:0.88rem; color:var(--ink-light);">Example slot labels: <code>who</code> ¬∑ <code>what happened</code> ¬∑ <code>where</code> ¬∑ <code>when</code> ¬∑ <code>from where</code> ¬∑ <code>to where</code> ¬∑ <code>with whom</code> ¬∑ <code>why</code> ¬∑ <code>cause</code> ¬∑ <code>effect</code> ¬∑ <code>duration</code> ¬∑ <code>who is left</code> ¬∑ <code>what is provided</code> ¬∑ <code>clan identity</code> ‚Äî use whatever the verse needs.</p>
  </div>

  <hr class="divider">

  <h3 style="margin-bottom:16px;">Final Check</h3>
  <p style="margin-bottom:16px; color:var(--ink-mid);">Before submitting any map, go back through the passage and ask:</p>

  <ul class="checklist" id="instr-checklist">
    <li onclick="toggleCheck(this)"><input type="checkbox" onclick="event.stopPropagation(); toggleCheck(this.parentElement)"><span>Is every person in each scene block of 2A, with their name where the text gives it?</span></li>
    <li onclick="toggleCheck(this)"><input type="checkbox" onclick="event.stopPropagation(); toggleCheck(this.parentElement)"><span>Is every place ‚Äî including transitional spaces ‚Äî in 2B, with its name?</span></li>
    <li onclick="toggleCheck(this)"><input type="checkbox" onclick="event.stopPropagation(); toggleCheck(this.parentElement)"><span>Is every object, natural element, duration, and significant absence in 2C?</span></li>
    <li onclick="toggleCheck(this)"><input type="checkbox" onclick="event.stopPropagation(); toggleCheck(this.parentElement)"><span>Does every verse have a proposition block?</span></li>
    <li onclick="toggleCheck(this)"><input type="checkbox" onclick="event.stopPropagation(); toggleCheck(this.parentElement)"><span>Does any sentence in the map reproduce the clause structure of the original text? (If yes, delete it.)</span></li>
    <li onclick="toggleCheck(this)"><input type="checkbox" onclick="event.stopPropagation(); toggleCheck(this.parentElement)"><span>Are all specific names, places, periods, and things named directly ‚Äî not paraphrased?</span></li>
    <li onclick="toggleCheck(this)"><input type="checkbox" onclick="event.stopPropagation(); toggleCheck(this.parentElement)"><span>Could a performer who has never read this passage reconstruct it faithfully in their own language from this map alone?</span></li>
  </ul>

</div>


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB 2: WORKED EXAMPLE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="tab-example" class="tab-panel fade-in">

  <div class="page-title">
    <div class="page-title-icon">üìñ</div>
    <div>
      <h2>Worked Example: Ruth 1:1‚Äì7</h2>
      <p>A complete map for the opening passage of Ruth ‚Äî all three levels</p>
    </div>
  </div>

  <!-- LEVEL 1 -->
  <div class="section-header">
    <span class="level-badge">Level 1</span>
    <h3>The Movement</h3>
  </div>
  <div class="section-body">
    <p>A family leaves their homeland under the pressure of famine, intending a temporary stay in a foreign country. They stay. The father dies. The sons grow up, marry local women, and then they too die. What began as survival becomes a decade-long exile ending in the erasure of the entire male line. The woman is left with two foreign daughters-in-law and nothing else ‚Äî no husband, no sons, no security, no visible future. Then a single piece of news arrives: food has returned to her homeland, and the God of that land is behind it. The passage ends with three widows on a road, moving.</p>
    <p>The pace is relentless in its accumulation of loss, death following death with no pause for grief. Then a stillness ‚Äî and a turn. The emotional arc is descent into emptiness, followed by the first fragile movement toward return. The theological thread is thin but load-bearing: God has acted. The woman hears. She moves. This section creates the conditions of total loss that make everything which follows extraordinary.</p>
  </div>

  <!-- LEVEL 2 -->
  <div class="section-header">
    <span class="level-badge">Level 2</span>
    <h3>The Scenes</h3>
  </div>
  <div class="section-body">

    <div class="example-scene">
      <h3>Scene 1 ‚Äî Verses 1‚Äì2 ¬∑ <em>A family leaves Bethlehem for Moab because of famine</em></h3>

      <details open>
        <summary>2A ‚Äî People</summary>
        <div class="details-body">
          <table class="data-table">
            <tr><th>Role</th><th>Name</th><th>Relationship</th><th>Wants</th><th>Fears / Carries</th></tr>
            <tr><td>Man, head of household</td><td><strong>Elimelech</strong></td><td>Husband and father; decision-maker</td><td>Keep family alive; move is temporary</td><td>Man of covenant people and land; dies in foreign soil</td></tr>
            <tr><td>Wife</td><td><strong>Naomi</strong></td><td>Wife of Elimelech</td><td>Survival; no independent decision here</td><td>Will carry all the grief that follows</td></tr>
            <tr><td>First son</td><td><strong>Mahlon</strong></td><td>Son of Elimelech and Naomi</td><td>Young; no independent role yet</td><td>Will die in Moab</td></tr>
            <tr><td>Second son</td><td><strong>Kilion</strong></td><td>Son of Elimelech and Naomi</td><td>Young; no independent role yet</td><td>Will die in Moab</td></tr>
          </table>
        </div>
      </details>

      <details>
        <summary>2B ‚Äî Places</summary>
        <div class="details-body">
          <table class="data-table">
            <tr><th>Role</th><th>Name</th><th>Type</th><th>Meaning</th><th>Effect on scene</th></tr>
            <tr><td>Town of origin</td><td><strong>Bethlehem, in Judah</strong></td><td>Town in covenant homeland</td><td>Identity, belonging, divine promise</td><td>Famine drives departure; the home they will return to</td></tr>
            <tr><td>Destination</td><td><strong>Moab</strong></td><td>Neighboring foreign nation</td><td>Not their land, people, or God</td><td>Place of exile; will become the place of death</td></tr>
          </table>
        </div>
      </details>

      <details>
        <summary>2C ‚Äî Objects &amp; Elements</summary>
        <div class="details-body">
          <table class="data-table">
            <tr><th>Item</th><th>What it is</th><th>Function</th><th>Signals</th></tr>
            <tr><td><strong>Famine</strong></td><td>Widespread crop failure</td><td>Force that drives the family from Bethlehem</td><td>Severe enough to uproot people from land, people, and God</td></tr>
          </table>
          <div class="notice"><strong>Significant absence:</strong> No possessions or goods are named. The family departs with nothing described. Their material life is invisible throughout.</div>
        </div>
      </details>

      <details>
        <summary>2D ‚Äî What Happens</summary>
        <div class="details-body"><p>A severe famine strikes the land. Elimelech decides to take his wife Naomi and their two sons Mahlon and Kilion from their home in Bethlehem in Judah and relocate temporarily to Moab. They leave and settle there.</p></div>
      </details>

      <details>
        <summary>2E ‚Äî Communicative Purpose</summary>
        <div class="details-body"><p>This scene introduces every element that will drive the story: the homeland, the foreign country, the family, and the crisis that displaces them. Bethlehem is established as the place of belonging. Moab is established as the place of exile. The move is framed as temporary ‚Äî which makes the decade that follows feel like a slow loss of intention.</p></div>
      </details>
    </div>

    <div class="example-scene">
      <h3>Scene 2 ‚Äî Verses 3‚Äì5 ¬∑ <em>Elimelech dies. The sons marry. The sons die. Naomi is left with nothing.</em></h3>

      <details>
        <summary>2A ‚Äî People</summary>
        <div class="details-body">
          <table class="data-table">
            <tr><th>Role</th><th>Name</th><th>Relationship</th><th>Wants</th><th>Fears / Carries</th></tr>
            <tr><td>Widow, bereaved mother</td><td><strong>Naomi</strong></td><td>Wife of Elimelech, widowed; mother of Mahlon and Kilion</td><td>Receiving blow after blow; no want shown</td><td>Carries husband's death then both sons'; ends scene emptied</td></tr>
            <tr><td>First son, now dead</td><td><strong>Mahlon</strong></td><td>Son of Naomi; husband of Ruth</td><td>Built a life in Moab; married</td><td>Dies without heir</td></tr>
            <tr><td>Second son, now dead</td><td><strong>Kilion</strong></td><td>Son of Naomi; husband of Orpah</td><td>Built a life in Moab; married</td><td>Dies without heir</td></tr>
            <tr><td>First daughter-in-law</td><td><strong>Orpah</strong></td><td>Moabite woman; wife of Kilion, widowed</td><td>Present and grieving; future unresolved</td><td>Foreigner to covenant people; will make different choice than Ruth</td></tr>
            <tr><td>Second daughter-in-law</td><td><strong>Ruth</strong></td><td>Moabite woman; wife of Mahlon, widowed</td><td>Present and grieving; future unresolved</td><td>Foreigner to covenant people; will make the extraordinary choice</td></tr>
          </table>
        </div>
      </details>

      <details>
        <summary>2B ‚Äî Places</summary>
        <div class="details-body">
          <table class="data-table">
            <tr><th>Role</th><th>Name</th><th>Type</th><th>Meaning</th><th>Effect</th></tr>
            <tr><td>Foreign country</td><td><strong>Moab</strong></td><td>Place of exile</td><td>Where the men die and marriages happen</td><td>All three losses occur here; Moab becomes associated with death</td></tr>
          </table>
        </div>
      </details>

      <details>
        <summary>2C ‚Äî Objects &amp; Elements</summary>
        <div class="details-body">
          <table class="data-table">
            <tr><th>Item</th><th>What it is</th><th>Function</th><th>Signals</th></tr>
            <tr><td><strong>Ten years</strong></td><td>Named duration of time</td><td>Marks how deeply the family put down roots in Moab</td><td>The temporary became a decade; the sojourn became a life</td></tr>
          </table>
          <div class="notice"><strong>Significant absence:</strong> No graves, no mourning rituals, no burial details. The deaths are stated as bare facts. The bluntness is part of the meaning.</div>
        </div>
      </details>

      <details>
        <summary>2D ‚Äî What Happens</summary>
        <div class="details-body"><p>Elimelech dies in Moab. Naomi is widowed. Her two sons grow up and each takes a Moabite wife ‚Äî Mahlon marries Ruth, Kilion marries Orpah. Approximately ten years pass. Then both sons die. Naomi is now left with her two daughters-in-law, all three of them widows, in a foreign country, with no male protection and no visible future.</p></div>
      </details>

      <details>
        <summary>2E ‚Äî Communicative Purpose</summary>
        <div class="details-body"><p>This scene completes the emptying of Naomi. Each loss is stated plainly and without comfort. It also introduces Orpah and Ruth by name and establishes them clearly as Moabite women ‚Äî outsiders to the covenant. Their continued presence with Naomi at the end of this scene sets up the decision that is coming.</p></div>
      </details>
    </div>

    <div class="example-scene">
      <h3>Scene 3 ‚Äî Verses 6‚Äì7 ¬∑ <em>Naomi hears that God has provided food. She decides to return. All three set out.</em></h3>

      <details>
        <summary>2A ‚Äî People</summary>
        <div class="details-body">
          <table class="data-table">
            <tr><th>Role</th><th>Name</th><th>Relationship</th><th>Wants</th><th>Fears / Carries</th></tr>
            <tr><td>Widow, now decision-maker</td><td><strong>Naomi</strong></td><td>Mother-in-law of Orpah and Ruth</td><td>Return to Bethlehem; back to her people and God</td><td>Total loss ‚Äî husband, sons, decade of exile ‚Äî but she hears and moves</td></tr>
            <tr><td>First daughter-in-law</td><td><strong>Orpah</strong></td><td>Moabite widow; daughter-in-law of Naomi</td><td>Follows Naomi's lead at this point</td><td>Leaving the only country she has ever known</td></tr>
            <tr><td>Second daughter-in-law</td><td><strong>Ruth</strong></td><td>Moabite widow; daughter-in-law of Naomi</td><td>Follows Naomi's lead at this point</td><td>Leaving the only country she has ever known</td></tr>
          </table>
        </div>
      </details>

      <details>
        <summary>2B ‚Äî Places</summary>
        <div class="details-body">
          <table class="data-table">
            <tr><th>Role</th><th>Name</th><th>Type</th><th>Meaning</th><th>Effect</th></tr>
            <tr><td>Place of departure</td><td><strong>Moab</strong></td><td>Foreign country they are leaving</td><td>Place of exile, marriage, death</td><td>First movement of return</td></tr>
            <tr><td>Destination</td><td><strong>Judah, toward Bethlehem</strong></td><td>Covenant homeland</td><td>Belonging, identity, and now provision</td><td>Food is there; God has acted there</td></tr>
            <tr><td>Transitional space</td><td><strong>The road between Moab and Judah</strong></td><td>Road between two countries</td><td>Neither Moab nor Bethlehem; place of movement and decision</td><td>Scene ends here ‚Äî in motion, unresolved, between worlds</td></tr>
          </table>
        </div>
      </details>

      <details>
        <summary>2C ‚Äî Objects &amp; Elements</summary>
        <div class="details-body">
          <table class="data-table">
            <tr><th>Item</th><th>What it is</th><th>Function</th><th>Signals</th></tr>
            <tr><td><strong>Food</strong></td><td>Restoration of sustenance in Bethlehem</td><td>News that reaches Naomi and triggers her decision</td><td>God has acted; the famine that started everything has ended</td></tr>
          </table>
        </div>
      </details>

      <details>
        <summary>2D ‚Äî What Happens</summary>
        <div class="details-body"><p>While still in Moab, Naomi hears that God has provided food for his people in Bethlehem ‚Äî the famine is over. She decides to return home. She and her two daughters-in-law leave their home in Moab and set out together on the road back toward Judah.</p></div>
      </details>

      <details>
        <summary>2E ‚Äî Communicative Purpose</summary>
        <div class="details-body"><p>This is the turn of the passage. After total emptiness, Naomi acts. The cause of her action is explicitly theological ‚Äî God has provided. The scene ends with all three women walking together, which makes the coming separation on the road dramatically significant.</p></div>
      </details>
    </div>
  </div>

  <!-- LEVEL 3 -->
  <div class="section-header">
    <span class="level-badge">Level 3</span>
    <h3>The Propositions</h3>
  </div>
  <div class="section-body">

    <div class="prop-block">
      <div class="prop-header">
        <span class="prop-num">1</span>
        <div>
          <div class="prop-verse">Verse 1a</div>
          <div class="prop-type">Establishes historical setting; names the period; introduces the crisis</div>
        </div>
      </div>
      <div class="slot-list">
        <div class="slot-row"><span class="slot-key">when</span><span class="slot-val">the days of the judges</span></div>
        <div class="slot-row"><span class="slot-key">what happened</span><span class="slot-val">a famine</span></div>
        <div class="slot-row"><span class="slot-key">where</span><span class="slot-val">in the land</span></div>
      </div>
    </div>

    <div class="prop-block">
      <div class="prop-header">
        <span class="prop-num">2</span>
        <div>
          <div class="prop-verse">Verse 1b</div>
          <div class="prop-type">Introduces Elimelech and his decision; names the family; names origin and destination</div>
        </div>
      </div>
      <div class="slot-list">
        <div class="slot-row"><span class="slot-key">what happened</span><span class="slot-val">a man emigrates temporarily</span></div>
        <div class="slot-row"><span class="slot-key">who</span><span class="slot-val">Elimelech</span></div>
        <div class="slot-row"><span class="slot-key">from where</span><span class="slot-val">Bethlehem in Judah</span></div>
        <div class="slot-row"><span class="slot-key">to where</span><span class="slot-val">the fields of Moab</span></div>
        <div class="slot-row"><span class="slot-key">with whom</span><span class="slot-val">his wife Naomi; his two sons Mahlon and Kilion</span></div>
      </div>
    </div>

    <div class="prop-block">
      <div class="prop-header">
        <span class="prop-num">3</span>
        <div>
          <div class="prop-verse">Verse 2</div>
          <div class="prop-type">Provides full names and clan identity; confirms settlement in Moab</div>
        </div>
      </div>
      <div class="slot-list">
        <div class="slot-row"><span class="slot-key">who</span><span class="slot-val">Elimelech, Naomi, Mahlon, Kilion</span></div>
        <div class="slot-row"><span class="slot-key">clan identity</span><span class="slot-val">Ephrathites from Bethlehem in Judah</span></div>
        <div class="slot-row"><span class="slot-key">where they are now</span><span class="slot-val">Moab</span></div>
      </div>
    </div>

    <div class="prop-block">
      <div class="prop-header">
        <span class="prop-num">4</span>
        <div>
          <div class="prop-verse">Verse 3</div>
          <div class="prop-type">Narrates the first death; establishes Naomi's new status</div>
        </div>
      </div>
      <div class="slot-list">
        <div class="slot-row"><span class="slot-key">what happened</span><span class="slot-val">Elimelech dies</span></div>
        <div class="slot-row"><span class="slot-key">where</span><span class="slot-val">in Moab</span></div>
        <div class="slot-row"><span class="slot-key">who is left</span><span class="slot-val">Naomi and her two sons</span></div>
      </div>
    </div>

    <div class="prop-block">
      <div class="prop-header">
        <span class="prop-num">5</span>
        <div>
          <div class="prop-verse">Verse 4</div>
          <div class="prop-type">Narrates the sons' marriages; names the wives; marks ten years passing</div>
        </div>
      </div>
      <div class="slot-list">
        <div class="slot-row"><span class="slot-key">what happened</span><span class="slot-val">the two sons each take a wife</span></div>
        <div class="slot-row"><span class="slot-key">who marries whom</span><span class="slot-val">Mahlon ‚Üí Ruth; Kilion ‚Üí Orpah</span></div>
        <div class="slot-row"><span class="slot-key">origin of wives</span><span class="slot-val">Moabite women</span></div>
        <div class="slot-row"><span class="slot-key">duration</span><span class="slot-val">approximately ten years</span></div>
      </div>
    </div>

    <div class="prop-block">
      <div class="prop-header">
        <span class="prop-num">6</span>
        <div>
          <div class="prop-verse">Verse 5</div>
          <div class="prop-type">Narrates the second and third deaths; establishes Naomi's complete isolation</div>
        </div>
      </div>
      <div class="slot-list">
        <div class="slot-row"><span class="slot-key">what happened</span><span class="slot-val">both sons die</span></div>
        <div class="slot-row"><span class="slot-key">who dies</span><span class="slot-val">Mahlon and Kilion</span></div>
        <div class="slot-row"><span class="slot-key">who is left</span><span class="slot-val">Naomi, without husband and without sons</span></div>
        <div class="slot-row"><span class="slot-key">who remains with her</span><span class="slot-val">Orpah and Ruth</span></div>
      </div>
    </div>

    <div class="prop-block">
      <div class="prop-header">
        <span class="prop-num">7</span>
        <div>
          <div class="prop-verse">Verse 6</div>
          <div class="prop-type">Narrates Naomi's decision to return; names the theological cause</div>
        </div>
      </div>
      <div class="slot-list">
        <div class="slot-row"><span class="slot-key">what happened</span><span class="slot-val">Naomi decides to return</span></div>
        <div class="slot-row"><span class="slot-key">who acts</span><span class="slot-val">Naomi</span></div>
        <div class="slot-row"><span class="slot-key">why</span><span class="slot-val">she heard that God had provided food for his people</span></div>
        <div class="slot-row"><span class="slot-key">who provided</span><span class="slot-val">God ‚Äî the God of the covenant people</span></div>
        <div class="slot-row"><span class="slot-key">what was provided</span><span class="slot-val">food</span></div>
        <div class="slot-row"><span class="slot-key">where</span><span class="slot-val">in Bethlehem in Judah</span></div>
        <div class="slot-row"><span class="slot-key">where Naomi is</span><span class="slot-val">still in Moab</span></div>
        <div class="slot-row"><span class="slot-key">with whom</span><span class="slot-val">her two daughters-in-law, Orpah and Ruth</span></div>
      </div>
    </div>

    <div class="prop-block">
      <div class="prop-header">
        <span class="prop-num">8</span>
        <div>
          <div class="prop-verse">Verse 7</div>
          <div class="prop-type">Narrates the departure; places all three women on the road</div>
        </div>
      </div>
      <div class="slot-list">
        <div class="slot-row"><span class="slot-key">what happened</span><span class="slot-val">they leave and set out on the road</span></div>
        <div class="slot-row"><span class="slot-key">who</span><span class="slot-val">Naomi, Orpah, and Ruth ‚Äî all three together</span></div>
        <div class="slot-row"><span class="slot-key">from where</span><span class="slot-val">Moab</span></div>
        <div class="slot-row"><span class="slot-key">direction</span><span class="slot-val">toward Judah</span></div>
      </div>
    </div>

  </div>
</div>


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB 3: FORM
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="tab-form" class="tab-panel fade-in">

  <div class="page-title">
    <div class="page-title-icon">‚úçÔ∏è</div>
    <div>
      <h2>Create a Prose Meaning Map</h2>
      <p>Complete every section. The JSON output is generated automatically as you type.</p>
    </div>
  </div>

  <div class="notice">Remember: Never reproduce sentences or clauses from the biblical text. Name specific things directly. Describe situations, not words.</div>

  <!-- META -->
  <div class="card">
    <h4>Passage Information</h4>
    <div class="meta-grid">
      <div class="form-group">
        <label class="field-label">Book</label>
        <input type="text" id="f-book" placeholder="e.g. Ruth" oninput="autoSave()">
      </div>
      <div class="form-group">
        <label class="field-label">Chapter</label>
        <input type="text" id="f-chapter" placeholder="e.g. 1" oninput="autoSave()">
      </div>
      <div class="form-group">
        <label class="field-label">Verses</label>
        <input type="text" id="f-verses" placeholder="e.g. 1-7" oninput="autoSave()">
      </div>
      <div class="form-group">
        <label class="field-label">Mapper name</label>
        <input type="text" id="f-mapper" placeholder="Your name" oninput="autoSave()">
      </div>
      <div class="form-group">
        <label class="field-label">Date</label>
        <input type="text" id="f-date" placeholder="YYYY-MM-DD" oninput="autoSave()">
      </div>
      <div class="form-group">
        <label class="field-label">Target language</label>
        <input type="text" id="f-lang" placeholder="e.g. Sater√©-Maw√©" oninput="autoSave()">
      </div>
    </div>
  </div>

  <!-- LEVEL 1 -->
  <div class="section-header">
    <span class="level-badge">Level 1</span>
    <h3>The Movement</h3>
  </div>
  <div class="section-body">
    <div class="field-hint">One paragraph. Describe the arc: emotional trajectory, theological significance, pacing, what this section accomplishes. Write in prose. No biblical sentences.</div>
    <textarea id="f-movement" rows="6" placeholder="Describe the arc of this entire passage..." oninput="autoSave()"></textarea>
  </div>

  <!-- LEVEL 2 -->
  <div class="section-header">
    <span class="level-badge">Level 2</span>
    <h3>The Scenes</h3>
  </div>
  <div class="section-body">
    <div class="field-hint">Divide the passage into natural episodes. Complete one full block per scene. Every person, place, and object must appear.</div>
    <div id="scenes-container"></div>
    <button class="btn btn-ghost" onclick="addScene()">+ Add Scene</button>
  </div>

  <!-- LEVEL 3 -->
  <div class="section-header">
    <span class="level-badge">Level 3</span>
    <h3>The Propositions</h3>
  </div>
  <div class="section-body">
    <div class="field-hint">One block per verse or closely connected clause cluster. Every verse receives a block. Use labeled slots only ‚Äî no sentences, no commentary.</div>
    <div id="props-container"></div>
    <button class="btn btn-ghost" onclick="addProp()">+ Add Proposition</button>
  </div>

  <!-- CHECKLIST -->
  <div class="card" style="margin-top:28px;">
    <h4>Final Checklist</h4>
    <p class="field-hint" style="margin-bottom:12px;">Check each item before submitting your map.</p>
    <ul class="checklist" id="form-checklist">
      <li onclick="toggleCheck(this)"><input type="checkbox" onclick="event.stopPropagation(); toggleCheck(this.parentElement)"><span>Every person is in 2A for each scene, with their name where the text gives it.</span></li>
      <li onclick="toggleCheck(this)"><input type="checkbox" onclick="event.stopPropagation(); toggleCheck(this.parentElement)"><span>Every place ‚Äî including transitional spaces ‚Äî is in 2B, with its name.</span></li>
      <li onclick="toggleCheck(this)"><input type="checkbox" onclick="event.stopPropagation(); toggleCheck(this.parentElement)"><span>Every object, natural element, duration, and significant absence is in 2C.</span></li>
      <li onclick="toggleCheck(this)"><input type="checkbox" onclick="event.stopPropagation(); toggleCheck(this.parentElement)"><span>Every verse has a proposition block.</span></li>
      <li onclick="toggleCheck(this)"><input type="checkbox" onclick="event.stopPropagation(); toggleCheck(this.parentElement)"><span>No sentence reproduces the clause structure of the original text.</span></li>
      <li onclick="toggleCheck(this)"><input type="checkbox" onclick="event.stopPropagation(); toggleCheck(this.parentElement)"><span>All specific names, places, periods, and things are named directly ‚Äî not paraphrased.</span></li>
      <li onclick="toggleCheck(this)"><input type="checkbox" onclick="event.stopPropagation(); toggleCheck(this.parentElement)"><span>A performer who has never read this passage could reconstruct it faithfully from this map alone.</span></li>
    </ul>
  </div>

  <div class="btn-row" style="margin-top:24px;">
    <button class="btn btn-gold" onclick="downloadJSON()">‚¨á Download JSON</button>
    <button class="btn btn-primary" onclick="showTab('json')">View JSON Output ‚Üí</button>
    <button class="btn btn-secondary" onclick="clearForm()">Clear Form</button>
    <span class="save-status" id="save-status"></span>
  </div>

</div>


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB 4: JSON OUTPUT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="tab-json" class="tab-panel fade-in">

  <div class="page-title">
    <div class="page-title-icon">{ }</div>
    <div>
      <h2>JSON Output</h2>
      <p>Auto-generated from your form. Ready for pipeline processing.</p>
    </div>
  </div>

  <div class="notice">This JSON is generated live from your form. Switch to the <strong>Create Map</strong> tab to edit. The structure is designed for direct input into the Tripod Method encoding pipeline.</div>

  <div class="json-toolbar">
    <button class="btn btn-gold" onclick="downloadJSON()">‚¨á Download JSON</button>
    <button class="btn btn-secondary" onclick="copyJSON()">üìã Copy to Clipboard</button>
    <button class="btn btn-ghost" onclick="loadExample()">Load Example (Ruth 1:1‚Äì7)</button>
  </div>

  <div class="json-section-label">Generated output</div>
  <div class="json-output" id="json-display">// Fill in the form to generate JSON output</div>

</div>
</main>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     FLOATING ASSISTANT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<button id="assistant-btn" onclick="toggleAssistant()" title="Ask the mapping assistant">üí¨</button>

<div id="assistant-panel">
  <div class="asst-header">
    <h4>Mapping Assistant</h4>
    <button onclick="toggleAssistant()">‚úï</button>
  </div>
  <div class="asst-messages" id="asst-messages">
    <div class="asst-msg system">Ask me anything about creating Prose Meaning Maps ‚Äî methodology, examples, or how to handle a specific verse.</div>
  </div>
  <div class="asst-input-row">
    <input type="text" id="asst-input" placeholder="Ask a question..." onkeydown="if(event.key==='Enter') sendMessage()">
    <button onclick="sendMessage()" id="asst-send">‚û§</button>
  </div>
</div>


<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showTab(id) {
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
  document.getElementById('tab-' + id).classList.add('active');
  const idx = ['instructions','example','form','json'].indexOf(id);
  document.querySelectorAll('nav button')[idx].classList.add('active');
  if (id === 'json') renderJSON();
  window.scrollTo(0,0);
}

function toggleCheck(el) {
  el.classList.toggle('checked');
  const cb = el.querySelector('input[type=checkbox]');
  if (cb) cb.checked = el.classList.contains('checked');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FORM STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let sceneCount = 0;
let propCount = 0;

function addScene(data) {
  sceneCount++;
  const id = sceneCount;
  const d = data || {};
  const container = document.getElementById('scenes-container');
  const div = document.createElement('div');
  div.className = 'scene-block fade-in';
  div.id = 'scene-' + id;
  div.innerHTML = `
    <div class="scene-block-header">
      <h4>Scene ${id}</h4>
      <button class="btn btn-danger" onclick="removeScene(${id})">Remove</button>
    </div>
    <div class="scene-block-body">
      <div style="display:grid; grid-template-columns:1fr 2fr; gap:12px; margin-bottom:16px;">
        <div class="form-group">
          <label class="field-label">Verses</label>
          <input type="text" id="s${id}-verses" placeholder="e.g. 1-2" value="${d.verses||''}" oninput="autoSave()">
        </div>
        <div class="form-group">
          <label class="field-label">Scene Title</label>
          <input type="text" id="s${id}-title" placeholder="Brief description of what happens" value="${d.title||''}" oninput="autoSave()">
        </div>
      </div>

      <div class="sub-section">
        <h4>2A ‚Äî People <span style="font-weight:300; text-transform:none; letter-spacing:0; font-size:0.78rem; color:var(--ink-light);">List every person. No one omitted. Include name where text gives it.</span></h4>
        <table class="dyn-table" id="s${id}-people-table">
          <tr><th>Role</th><th>Name</th><th>Relationship</th><th>Wants</th><th>Fears / Carries</th><th style="width:36px"></th></tr>
          ${(d.people||[{}]).map(p => personRow(id, p)).join('')}
        </table>
        <button class="btn btn-sm btn-secondary" onclick="addRow('s${id}-people-table', personRow.bind(null,${id}))">+ Person</button>
      </div>

      <div class="sub-section">
        <h4>2B ‚Äî Places <span style="font-weight:300; text-transform:none; letter-spacing:0; font-size:0.78rem; color:var(--ink-light);">Every location including transitional spaces. Named.</span></h4>
        <table class="dyn-table" id="s${id}-places-table">
          <tr><th>Role in scene</th><th>Name</th><th>Type</th><th>Meaning</th><th>Effect on scene</th><th style="width:36px"></th></tr>
          ${(d.places||[{}]).map(p => placeRow(id, p)).join('')}
        </table>
        <button class="btn btn-sm btn-secondary" onclick="addRow('s${id}-places-table', placeRow.bind(null,${id}))">+ Place</button>
      </div>

      <div class="sub-section">
        <h4>2C ‚Äî Objects &amp; Elements <span style="font-weight:300; text-transform:none; letter-spacing:0; font-size:0.78rem; color:var(--ink-light);">Exhaustive: artifacts, food, animals, plants, durations. Nothing too minor.</span></h4>
        <table class="dyn-table" id="s${id}-objects-table">
          <tr><th>Item</th><th>What it is</th><th>Function in scene</th><th>What it signals</th><th style="width:36px"></th></tr>
          ${(d.objects_and_elements||[{}]).map(o => objectRow(id, o)).join('')}
        </table>
        <button class="btn btn-sm btn-secondary" onclick="addRow('s${id}-objects-table', objectRow.bind(null,${id}))">+ Item</button>
        <div class="form-group" style="margin-top:10px;">
          <label class="field-label" style="font-size:0.76rem;">Significant absences</label>
          <textarea id="s${id}-absences" rows="2" placeholder="Things conspicuously missing ‚Äî their absence is meaningful..." oninput="autoSave()">${d.significant_absences||''}</textarea>
        </div>
      </div>

      <div class="sub-section">
        <h4>2D ‚Äî What Happens</h4>
        <textarea id="s${id}-happens" rows="4" placeholder="Full sequence of actions, in order. Specific about cause and effect. No biblical sentences." oninput="autoSave()">${d.what_happens||''}</textarea>
      </div>

      <div class="sub-section">
        <h4>2E ‚Äî Communicative Purpose</h4>
        <textarea id="s${id}-purpose" rows="3" placeholder="Why does this scene exist? What would be lost without it?" oninput="autoSave()">${d.communicative_purpose||''}</textarea>
      </div>
    </div>
  `;
  container.appendChild(div);
}

function personRow(sid, d) {
  d = d||{};
  return `<tr>
    <td><input type="text" placeholder="Role" value="${d.role||''}" oninput="autoSave()"></td>
    <td><input type="text" placeholder="Name" value="${d.name||''}" oninput="autoSave()"></td>
    <td><input type="text" placeholder="Relationship" value="${d.relationship||''}" oninput="autoSave()"></td>
    <td><input type="text" placeholder="Wants" value="${d.wants||''}" oninput="autoSave()"></td>
    <td><input type="text" placeholder="Fears / Carries" value="${d.fears_carries||''}" oninput="autoSave()"></td>
    <td><button class="del-btn" onclick="this.closest('tr').remove(); autoSave()">√ó</button></td>
  </tr>`;
}

function placeRow(sid, d) {
  d = d||{};
  return `<tr>
    <td><input type="text" placeholder="Role in scene" value="${d.role_in_scene||''}" oninput="autoSave()"></td>
    <td><input type="text" placeholder="Name" value="${d.name||''}" oninput="autoSave()"></td>
    <td><input type="text" placeholder="Type" value="${d.type||''}" oninput="autoSave()"></td>
    <td><input type="text" placeholder="Meaning" value="${d.meaning||''}" oninput="autoSave()"></td>
    <td><input type="text" placeholder="Effect on scene" value="${d.effect_on_scene||''}" oninput="autoSave()"></td>
    <td><button class="del-btn" onclick="this.closest('tr').remove(); autoSave()">√ó</button></td>
  </tr>`;
}

function objectRow(sid, d) {
  d = d||{};
  return `<tr>
    <td><input type="text" placeholder="Item" value="${d.item||''}" oninput="autoSave()"></td>
    <td><input type="text" placeholder="What it is" value="${d.what_it_is||''}" oninput="autoSave()"></td>
    <td><input type="text" placeholder="Function in scene" value="${d.function_in_scene||''}" oninput="autoSave()"></td>
    <td><input type="text" placeholder="What it signals" value="${d.what_it_signals||''}" oninput="autoSave()"></td>
    <td><button class="del-btn" onclick="this.closest('tr').remove(); autoSave()">√ó</button></td>
  </tr>`;
}

function addRow(tableId, rowFn) {
  const table = document.getElementById(tableId);
  const tr = document.createElement('tr');
  tr.innerHTML = rowFn({}).replace(/^<tr>|<\/tr>$/g,'');
  table.appendChild(tr);
}

function removeScene(id) {
  const el = document.getElementById('scene-' + id);
  if (el) el.remove();
  autoSave();
}

function addProp(data) {
  propCount++;
  const id = propCount;
  const d = data || {};
  const container = document.getElementById('props-container');
  const div = document.createElement('div');
  div.className = 'prop-form-block fade-in';
  div.id = 'prop-' + id;

  const slots = d.slots || {};
  const slotRows = Object.entries(slots).map(([k,v]) => slotEditRow(k, Array.isArray(v) ? v.join('; ') : String(v))).join('');

  div.innerHTML = `
    <div class="prop-form-header">
      <div class="prop-label">
        <span class="prop-num" style="width:26px;height:26px;font-size:0.75rem;">${id}</span>
        Proposition ${id}
      </div>
      <button class="btn btn-danger" onclick="removeProp(${id})">Remove</button>
    </div>
    <div class="prop-form-body">
      <div style="display:grid; grid-template-columns:1fr 2fr; gap:12px; margin-bottom:12px;">
        <div class="form-group">
          <label class="field-label" style="font-size:0.76rem;">Verse</label>
          <input type="text" id="p${id}-verse" placeholder="e.g. 1a" value="${d.verse||''}" oninput="autoSave()">
        </div>
        <div class="form-group">
          <label class="field-label" style="font-size:0.76rem;">Type of statement</label>
          <input type="text" id="p${id}-type" placeholder="e.g. introduces characters; names origin" value="${d.type_of_statement||''}" oninput="autoSave()">
        </div>
      </div>
      <div class="slot-editor" id="p${id}-slots">
        <label class="field-label" style="font-size:0.76rem; margin-bottom:8px; display:block;">Slots ‚Äî add one row per slot (label: value)</label>
        ${slotRows || slotEditRow('','') }
      </div>
      <button class="btn btn-sm btn-secondary" style="margin-top:6px;" onclick="addSlotRow(${id})">+ Add slot</button>
    </div>
  `;
  container.appendChild(div);
}

function slotEditRow(key, val) {
  return `<div class="slot-row-edit">
    <input type="text" class="slot-key-input" placeholder="label (e.g. who)" value="${escHtml(key)}" oninput="autoSave()">
    <input type="text" placeholder="value" value="${escHtml(val)}" oninput="autoSave()">
    <button class="del-btn" onclick="this.closest('.slot-row-edit').remove(); autoSave()">√ó</button>
  </div>`;
}

function addSlotRow(propId) {
  const container = document.getElementById('p' + propId + '-slots');
  const div = document.createElement('div');
  div.innerHTML = slotEditRow('','');
  container.insertBefore(div.firstChild, container.lastElementChild);
}

function removeProp(id) {
  const el = document.getElementById('prop-' + id);
  if (el) el.remove();
  autoSave();
}

function escHtml(s) {
  return String(s||'').replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA EXTRACTION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getFormData() {
  const book = val('f-book');
  const chapter = val('f-chapter');
  const verses = val('f-verses');
  const ref = [book, chapter ? chapter + (verses ? ':' + verses : '') : ''].filter(Boolean).join(' ');

  const data = {
    meta: {
      schema_version: "1.0",
      method: "Tripod Method - Prose Meaning Map",
      passage_reference: ref,
      book, chapter, verses,
      mapper: val('f-mapper'),
      date: val('f-date'),
      language_target: val('f-lang')
    },
    level_1_movement: { text: val('f-movement') },
    level_2_scenes: [],
    level_3_propositions: []
  };

  // Scenes
  document.querySelectorAll('[id^="scene-"]').forEach(el => {
    const id = el.id.replace('scene-','');
    const scene = {
      scene_number: parseInt(id),
      verses: val(`s${id}-verses`),
      title: val(`s${id}-title`),
      people: tableRows(`s${id}-people-table`, ['role','name','relationship','wants','fears_carries']),
      places: tableRows(`s${id}-places-table`, ['role_in_scene','name','type','meaning','effect_on_scene']),
      objects_and_elements: tableRows(`s${id}-objects-table`, ['item','what_it_is','function_in_scene','what_it_signals']),
      significant_absences: val(`s${id}-absences`),
      what_happens: val(`s${id}-happens`),
      communicative_purpose: val(`s${id}-purpose`)
    };
    data.level_2_scenes.push(scene);
  });

  // Props
  document.querySelectorAll('[id^="prop-"]').forEach(el => {
    const id = el.id.replace('prop-','');
    const slots = {};
    el.querySelectorAll('.slot-row-edit').forEach(row => {
      const inputs = row.querySelectorAll('input');
      const k = inputs[0] ? inputs[0].value.trim() : '';
      const v = inputs[1] ? inputs[1].value.trim() : '';
      if (k) slots[k] = v;
    });
    data.level_3_propositions.push({
      proposition_number: parseInt(id),
      verse: val(`p${id}-verse`),
      type_of_statement: val(`p${id}-type`),
      slots
    });
  });

  return data;
}

function val(id) {
  const el = document.getElementById(id);
  return el ? el.value.trim() : '';
}

function tableRows(tableId, fields) {
  const table = document.getElementById(tableId);
  if (!table) return [];
  const rows = [];
  table.querySelectorAll('tr:not(:first-child)').forEach(tr => {
    const inputs = tr.querySelectorAll('input[type=text]');
    const obj = {};
    fields.forEach((f,i) => { obj[f] = inputs[i] ? inputs[i].value.trim() : ''; });
    if (Object.values(obj).some(v => v)) rows.push(obj);
  });
  return rows;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// JSON RENDERING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderJSON() {
  const data = getFormData();
  const json = JSON.stringify(data, null, 2);
  const el = document.getElementById('json-display');
  el.textContent = json;
}

function autoSave() {
  try {
    const data = getFormData();
    localStorage.setItem('pmm-draft', JSON.stringify(data));
    const el = document.getElementById('save-status');
    if (el) {
      el.textContent = 'Auto-saved';
      setTimeout(() => { el.textContent = ''; }, 2000);
    }
  } catch(e) {}
  // If JSON tab is open, re-render live
  if (document.getElementById('tab-json').classList.contains('active')) {
    renderJSON();
  }
}

function downloadJSON() {
  const data = getFormData();
  const json = JSON.stringify(data, null, 2);
  const book = data.meta.book || 'map';
  const ch = data.meta.chapter || '';
  const vs = data.meta.verses || '';
  const filename = `pmm_${book}${ch ? '_' + ch : ''}${vs ? '_' + vs : ''}.json`.replace(/\s+/g,'_');
  const blob = new Blob([json], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = filename; a.click();
  URL.revokeObjectURL(url);
}

function copyJSON() {
  const data = getFormData();
  navigator.clipboard.writeText(JSON.stringify(data, null, 2)).then(() => {
    const btn = event.target;
    const orig = btn.textContent;
    btn.textContent = '‚úì Copied!';
    setTimeout(() => btn.textContent = orig, 2000);
  });
}

function clearForm() {
  if (!confirm('Clear all form data? This cannot be undone.')) return;
  document.querySelectorAll('[id^="scene-"]').forEach(el => el.remove());
  document.querySelectorAll('[id^="prop-"]').forEach(el => el.remove());
  sceneCount = 0; propCount = 0;
  ['f-book','f-chapter','f-verses','f-mapper','f-date','f-lang','f-movement'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = '';
  });
  localStorage.removeItem('pmm-draft');
  autoSave();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LOAD EXAMPLE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function loadExample() {
  if (document.querySelectorAll('[id^="scene-"]').length > 0 || document.querySelectorAll('[id^="prop-"]').length > 0) {
    if (!confirm('This will replace your current form with the Ruth 1:1‚Äì7 example. Continue?')) return;
  }
  clearFormSilent();
  loadFromData(EXAMPLE_DATA);
  showTab('form');
}

function clearFormSilent() {
  document.querySelectorAll('[id^="scene-"]').forEach(el => el.remove());
  document.querySelectorAll('[id^="prop-"]').forEach(el => el.remove());
  sceneCount = 0; propCount = 0;
}

function loadFromData(data) {
  const set = (id, v) => { const el = document.getElementById(id); if (el) el.value = v||''; };
  set('f-book', data.meta.book);
  set('f-chapter', data.meta.chapter);
  set('f-verses', data.meta.verses);
  set('f-mapper', data.meta.mapper);
  set('f-date', data.meta.date);
  set('f-lang', data.meta.language_target);
  set('f-movement', data.level_1_movement.text);
  (data.level_2_scenes||[]).forEach(s => addScene(s));
  (data.level_3_propositions||[]).forEach(p => addProp(p));
  autoSave();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ASSISTANT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let assistantOpen = false;
let asstHistory = [];

function toggleAssistant() {
  assistantOpen = !assistantOpen;
  const panel = document.getElementById('assistant-panel');
  const btn = document.getElementById('assistant-btn');
  panel.classList.toggle('open', assistantOpen);
  btn.textContent = assistantOpen ? '‚úï' : 'üí¨';
}

async function sendMessage() {
  const input = document.getElementById('asst-input');
  const text = input.value.trim();
  if (!text) return;

  appendMsg('user', text);
  asstHistory.push({ role: 'user', content: text });
  input.value = '';

  const sendBtn = document.getElementById('asst-send');
  sendBtn.disabled = true;

  const thinking = appendMsg('thinking', '‚Ä¶');

  try {
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 1000,
        system: `You are a methodology assistant for the Prose Meaning Maps tool, part of the Tripod Method for AI-Assisted Oral Bible Translation developed by Marcia Suzuki at the OBT Lab, Shema Bible Translation, YWAM Kansas City.

Your role is to help analysts (mappers) create high-quality Prose Meaning Maps. You know this method deeply:

CORE RULE: Never reproduce sentences or clauses of the biblical text. Individual specific words (names, places, things) are named directly. The goal is to describe the communicative situation so completely that a performer can reconstruct the passage faithfully in another language without translating from a bridge language.

THREE LEVELS:
- Level 1: One paragraph describing the movement/arc of the whole section ‚Äî emotional trajectory, theological significance, pacing.
- Level 2: Scene analysis ‚Äî divided into natural episodes (3-6 verses). Each scene has: People (2A, exhaustive, named), Places (2B, exhaustive, named), Objects/Elements (2C, exhaustive), What Happens (2D), Communicative Purpose (2E).
- Level 3: Propositions ‚Äî one block per verse, using labeled semantic slots (who/what happened/where/when/etc.). No sentences. No commentary. Just clean slot-filler pairs.

KEY PRINCIPLES:
- Completeness is the standard. Missing anything is a failure.
- Names of people and places are always included directly.
- The rule against paraphrasing applies to clauses and sentences, not individual words.
- Significant absences (things conspicuously not mentioned) must be noted.
- Level 3 slots should be clean and direct ‚Äî "what happened: a famine" not lengthy descriptions.

Answer questions clearly, concisely, and in the spirit of helping someone produce excellent, faithful maps. Be encouraging but precise about methodology.`,
        messages: asstHistory
      })
    });

    const data = await response.json();
    thinking.remove();
    const reply = data.content && data.content[0] ? data.content[0].text : 'Sorry, I could not get a response.';
    appendMsg('assistant', reply);
    asstHistory.push({ role: 'assistant', content: reply });

  } catch(e) {
    thinking.remove();
    appendMsg('assistant', 'Connection error. Please check your internet connection and try again.');
  }

  sendBtn.disabled = false;
}

function appendMsg(type, text) {
  const container = document.getElementById('asst-messages');
  const div = document.createElement('div');
  div.className = `asst-msg ${type}`;
  div.textContent = text;
  container.appendChild(div);
  container.scrollTop = container.scrollHeight;
  return div;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EXAMPLE DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const EXAMPLE_DATA = {
  meta: {
    schema_version: "1.0",
    method: "Tripod Method - Prose Meaning Map",
    passage_reference: "Ruth 1:1-7",
    book: "Ruth", chapter: "1", verses: "1-7",
    mapper: "Example", date: "2025-01-01", language_target: ""
  },
  level_1_movement: {
    text: "A family leaves their homeland under the pressure of famine, intending a temporary stay in a foreign country. They stay. The father dies. The sons grow up, marry local women, and then they too die. What began as survival becomes a decade-long exile ending in the erasure of the entire male line. The woman is left with two foreign daughters-in-law and nothing else ‚Äî no husband, no sons, no security, no visible future. Then a single piece of news arrives: food has returned to her homeland, and the God of that land is behind it. The passage ends with three widows on a road, moving.\n\nThe pace is relentless in its accumulation of loss, death following death with no pause for grief. Then a stillness ‚Äî and a turn. The emotional arc is descent into emptiness, followed by the first fragile movement toward return. The theological thread is thin but load-bearing: God has acted. The woman hears. She moves. This section creates the conditions of total loss that make everything which follows extraordinary."
  },
  level_2_scenes: [
    {
      scene_number: 1, verses: "1-2", title: "A family leaves Bethlehem for Moab because of famine",
      people: [
        { role: "Man, head of household", name: "Elimelech", relationship: "Husband and father; decision-maker for the family", wants: "To keep his family alive; the move is intended as temporary", fears_carries: "A man of a specific people and land; carries the identity of the covenant community" },
        { role: "Wife", name: "Naomi", relationship: "Wife of Elimelech; she follows her husband", wants: "Survival; she has no independent decision in this scene", fears_carries: "She will carry all the grief of what follows" },
        { role: "First son", name: "Mahlon", relationship: "Son of Elimelech and Naomi", wants: "He is young; no independent role yet", fears_carries: "He will die in Moab" },
        { role: "Second son", name: "Kilion", relationship: "Son of Elimelech and Naomi", wants: "He is young; no independent role yet", fears_carries: "He will die in Moab" }
      ],
      places: [
        { role_in_scene: "Town of origin", name: "Bethlehem, in Judah", type: "A town in the covenant homeland", meaning: "Place of identity, belonging, and divine promise", effect_on_scene: "The famine here drives the departure; it is the home they leave and will return to" },
        { role_in_scene: "Destination", name: "Moab", type: "A neighboring foreign nation", meaning: "Not their land, not their people, not their God", effect_on_scene: "The place of exile; it will become the place of death" }
      ],
      objects_and_elements: [
        { item: "Famine", what_it_is: "Widespread crop failure", function_in_scene: "The force that drives the family from Bethlehem", what_it_signals: "Severe enough to uproot people from their land, their people, and their God" }
      ],
      significant_absences: "No possessions or goods are named. The family departs with nothing described. Their material life is invisible throughout.",
      what_happens: "A severe famine strikes the land. Elimelech decides to take his wife Naomi and their two sons Mahlon and Kilion from their home in Bethlehem in Judah and relocate temporarily to Moab. They leave and settle there.",
      communicative_purpose: "This scene introduces every element that will drive the story: the homeland, the foreign country, the family, and the crisis that displaces them. Bethlehem is established as the place of belonging. Moab is the place of exile. The move is framed as temporary ‚Äî which makes the decade that follows feel like a slow loss of intention."
    },
    {
      scene_number: 2, verses: "3-5", title: "Elimelech dies. The sons marry Moabite women. The sons die. Naomi is left with nothing.",
      people: [
        { role: "Widow, bereaved mother", name: "Naomi", relationship: "Wife of Elimelech, now widowed; mother of Mahlon and Kilion", wants: "She is not shown wanting anything ‚Äî she is receiving blow after blow", fears_carries: "Carries the death of her husband, then both sons; ends this scene completely emptied" },
        { role: "First son, now dead", name: "Mahlon", relationship: "Son of Naomi; husband of Ruth", wants: "He built a life in Moab and married", fears_carries: "Dies without an heir" },
        { role: "Second son, now dead", name: "Kilion", relationship: "Son of Naomi; husband of Orpah", wants: "He built a life in Moab and married", fears_carries: "Dies without an heir" },
        { role: "First daughter-in-law", name: "Orpah", relationship: "Moabite woman; wife of Kilion, now widow", wants: "Present and grieving; her future is unresolved", fears_carries: "A foreigner to the covenant people; she will make a different choice than Ruth" },
        { role: "Second daughter-in-law", name: "Ruth", relationship: "Moabite woman; wife of Mahlon, now widow", wants: "Present and grieving; her future is unresolved", fears_carries: "A foreigner to the covenant people; she will make the extraordinary choice" }
      ],
      places: [
        { role_in_scene: "Foreign country of settlement", name: "Moab", type: "The place of exile", meaning: "Where the men die and the marriages happen", effect_on_scene: "All three losses occur here; Moab becomes associated with death" }
      ],
      objects_and_elements: [
        { item: "Ten years", what_it_is: "A named duration of time", function_in_scene: "Marks how deeply the family put down roots in Moab", what_it_signals: "The temporary became a decade; the sojourn became a life" }
      ],
      significant_absences: "No graves, no mourning rituals, no burial details. The deaths are stated as bare facts. The bluntness is part of the meaning.",
      what_happens: "Elimelech dies in Moab. Naomi is widowed. Her two sons grow up and each takes a Moabite wife ‚Äî Mahlon marries Ruth, Kilion marries Orpah. Approximately ten years pass. Then both sons die. Naomi is now left with her two daughters-in-law, all three of them widows, in a foreign country, with no male protection and no visible future.",
      communicative_purpose: "This scene completes the emptying of Naomi. Each loss is stated plainly and without comfort. It also introduces Orpah and Ruth by name and establishes them clearly as Moabite women ‚Äî outsiders to the covenant. Their continued presence with Naomi at the end of this scene sets up the decision that is coming."
    },
    {
      scene_number: 3, verses: "6-7", title: "Naomi hears that God has provided food in Bethlehem. She decides to return. All three women set out.",
      people: [
        { role: "Widow, now decision-maker", name: "Naomi", relationship: "Mother-in-law of Orpah and Ruth", wants: "To return to Bethlehem; to go back to her people and her God", fears_carries: "Carries total loss ‚Äî husband, sons, a decade of exile ‚Äî but she has heard news and she moves" },
        { role: "First daughter-in-law", name: "Orpah", relationship: "Moabite widow; daughter-in-law of Naomi", wants: "Follows Naomi's lead at this point", fears_carries: "Leaving the only country she has ever known" },
        { role: "Second daughter-in-law", name: "Ruth", relationship: "Moabite widow; daughter-in-law of Naomi", wants: "Follows Naomi's lead at this point", fears_carries: "Leaving the only country she has ever known" }
      ],
      places: [
        { role_in_scene: "Place of departure", name: "Moab", type: "The foreign country they are leaving", meaning: "Place of exile, marriage, death, and a decade of loss", effect_on_scene: "They leave it; the departure is the first movement of return" },
        { role_in_scene: "Destination", name: "Judah, toward Bethlehem", type: "The covenant homeland", meaning: "Place of belonging, identity, and now provision", effect_on_scene: "Food is there; God has acted there" },
        { role_in_scene: "Transitional space", name: "The road between Moab and Judah", type: "A road between two countries", meaning: "Neither Moab nor Bethlehem; a place of movement and decision", effect_on_scene: "The scene ends here ‚Äî in motion, unresolved, between worlds" }
      ],
      objects_and_elements: [
        { item: "Food", what_it_is: "Restoration of sustenance in Bethlehem", function_in_scene: "The news that reaches Naomi and triggers her decision", what_it_signals: "God has acted; the famine that started everything has ended" }
      ],
      significant_absences: "",
      what_happens: "While still in Moab, Naomi hears that God has provided food for his people in Bethlehem ‚Äî the famine is over. She decides to return home. She and her two daughters-in-law leave their home in Moab and set out together on the road back toward Judah.",
      communicative_purpose: "This is the turn of the passage. After total emptiness, Naomi acts. The cause of her action is explicitly theological ‚Äî God has provided. The scene ends with all three women walking together, which makes the coming separation on the road dramatically significant."
    }
  ],
  level_3_propositions: [
    { proposition_number: 1, verse: "1a", type_of_statement: "Establishes historical setting; names the period; introduces the crisis", slots: { "when": "the days of the judges", "what happened": "a famine", "where": "in the land" } },
    { proposition_number: 2, verse: "1b", type_of_statement: "Introduces Elimelech and his decision; names the family; names origin and destination", slots: { "what happened": "a man emigrates temporarily", "who": "Elimelech", "from where": "Bethlehem in Judah", "to where": "the fields of Moab", "with whom": "his wife Naomi; his two sons Mahlon and Kilion" } },
    { proposition_number: 3, verse: "2", type_of_statement: "Provides full names and clan identity; confirms settlement in Moab", slots: { "who": "Elimelech, Naomi, Mahlon, Kilion", "clan identity": "Ephrathites from Bethlehem in Judah", "where they are now": "Moab" } },
    { proposition_number: 4, verse: "3", type_of_statement: "Narrates the first death; establishes Naomi's new status", slots: { "what happened": "Elimelech dies", "where": "in Moab", "who is left": "Naomi and her two sons" } },
    { proposition_number: 5, verse: "4", type_of_statement: "Narrates the sons' marriages; names the wives; marks ten years passing", slots: { "what happened": "the two sons each take a wife", "who marries whom": "Mahlon ‚Üí Ruth; Kilion ‚Üí Orpah", "origin of wives": "Moabite women", "duration": "approximately ten years" } },
    { proposition_number: 6, verse: "5", type_of_statement: "Narrates the second and third deaths; establishes Naomi's complete isolation", slots: { "what happened": "both sons die", "who dies": "Mahlon and Kilion", "who is left": "Naomi, without husband and without sons", "who remains with her": "Orpah and Ruth" } },
    { proposition_number: 7, verse: "6", type_of_statement: "Narrates Naomi's decision to return; names the theological cause", slots: { "what happened": "Naomi decides to return", "who acts": "Naomi", "why": "she heard that God had provided food for his people", "who provided": "God ‚Äî the God of the covenant people", "what was provided": "food", "where": "in Bethlehem in Judah", "where Naomi is": "still in Moab", "with whom": "her two daughters-in-law, Orpah and Ruth" } },
    { proposition_number: 8, verse: "7", type_of_statement: "Narrates the departure; places all three women on the road", slots: { "what happened": "they leave and set out on the road", "who": "Naomi, Orpah, and Ruth ‚Äî all three together", "from where": "Moab", "direction": "toward Judah" } }
  ]
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.addEventListener('DOMContentLoaded', () => {
  // Try to restore draft
  try {
    const draft = localStorage.getItem('pmm-draft');
    if (draft) {
      const data = JSON.parse(draft);
      if (data.meta && (data.meta.book || data.level_2_scenes.length || data.level_3_propositions.length)) {
        loadFromData(data);
        return;
      }
    }
  } catch(e) {}
  // Default: one empty scene, one empty prop
  addScene();
  addProp();
});
</script>
</body>
</html>
